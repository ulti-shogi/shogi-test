<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>CSV + ソート & 検索</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f2f2f2; cursor: pointer; }
    .search-boxes input { width: 100%; box-sizing: border-box; padding: 4px; }
  </style>
</head>
<body>
  <h1>棋士データ（CSV読み込み）</h1>
  <div id="table-container">読み込み中...</div>

  <script>
    // CSVを読み込む
    fetch('kishi.csv')
      .then(response => response.text())
      .then(text => {
        const rows = text.trim().split('\n').map(r => r.split(','));
        const headers = rows[0];
        const data = rows.slice(1);

        // テーブルを生成
        const container = document.getElementById('table-container');
        container.innerHTML = `
          <table id="kishi-table">
            <thead>
              <tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>
              <tr class="search-boxes">${headers.map(() => `<td><input type="text"></td>`).join('')}</tr>
            </thead>
            <tbody>
              ${data.map(r => `<tr>${r.map(c => `<td>${c}</td>`).join('')}</tr>`).join('')}
            </tbody>
          </table>
        `;

        const table = document.getElementById('kishi-table');
        const tbody = table.querySelector('tbody');
        let sortOrder = 1;

        // ソート機能
        table.querySelectorAll('th').forEach((th, colIndex) => {
          th.addEventListener('click', () => {
            const rowsArray = Array.from(tbody.querySelectorAll('tr'));
            rowsArray.sort((a, b) => {
              const A = a.children[colIndex].textContent;
              const B = b.children[colIndex].textContent;
              return A.localeCompare(B, 'ja') * sortOrder;
            });
            sortOrder *= -1;
            rowsArray.forEach(r => tbody.appendChild(r));
          });
        });

        // 検索機能
        table.querySelectorAll('.search-boxes input').forEach((input, colIndex) => {
          input.addEventListener('input', () => {
            const filters = Array.from(table.querySelectorAll('.search-boxes input')).map(i => i.value.toLowerCase());
            tbody.querySelectorAll('tr').forEach(row => {
              const cells = Array.from(row.children).map(td => td.textContent.toLowerCase());
              const match = filters.every((f, i) => !f || cells[i].includes(f));
              row.style.display = match ? '' : 'none';
            });
          });
        });
      })
      .catch(err => {
        document.getElementById('table-container').innerText = 'CSV読み込み失敗: ' + err;
      });
  </script>
</body>
</html>
