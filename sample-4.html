<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>兵庫県 白地図（神戸市だけ赤・スタイル剥がし版）</title>

<body style="font-family: system-ui, sans-serif; margin: 16px;">
  <section style="margin-bottom:12px">
    <h3 style="margin:0 0 8px;">兵庫県 白地図（SVG）</h3>
    <p style="margin:0">
      同じフォルダに <code>hyogo.svg</code>（Wikipediaの兵庫県市区町村SVG）を置いてください。<br>
      このページはSVGを文字列として読み込み、内蔵スタイルを削除してから描画します。
    </p>
  </section>

  <div id="svg-wrap" style="width:100%; max-width:720px; border:1px solid #ddd;"></div>

  <script>
  const obj = document.querySelector('object');

  obj.addEventListener('load', () => {
    const svgDoc = obj.contentDocument;
    if (!svgDoc) { console.warn('SVG参照不可'); return; }
    const svgRoot = svgDoc.documentElement;

    // 0) 内蔵<style>を削除（元の配色を無効化）
    svgRoot.querySelectorAll('style').forEach(s => s.remove());

    const BASE = '#eeeeee';
    const RED  = '#ff4d4f';
    const CITY_CANDIDATES = ['神戸市','Kobe']; // どちらでもOKにする

    // 1) 全面グレー
    svgRoot.querySelectorAll('path, polygon, rect, circle, ellipse').forEach(el => {
      el.removeAttribute('fill');
      if (el.style) el.style.fill = null;
      el.setAttribute('fill', BASE);
    });

    // 2) 神戸市を探す（id / data-name / aria-label / <title>）
    const found = new Set();
    for (const name of CITY_CANDIDATES) {
      // id / data-name / aria-label
      const esc = CSS.escape(name);
      svgRoot.querySelectorAll(`#${esc}, [data-name="${name}"], [aria-label="${name}"]`)
             .forEach(el => found.add(el));

      // <title>神戸市</title> or <title>Kobe</title>
      svgRoot.querySelectorAll('g, path, polygon, rect, circle, ellipse').forEach(el => {
        const t = el.querySelector('title');
        if (!t) return;
        const txt = (t.textContent || '').trim();
        if (txt === name) found.add(el);
        // 部分一致（例：'神戸市中央区' など）も一応拾う
        if (txt.includes(name)) found.add(el);
      });
    }

    // g要素なら中の図形へ展開
    const targets = new Set();
    if (found.size === 0) {
      // デバッグ：<title>一覧を一部出力してヒント表示
      const titles = [];
      svgRoot.querySelectorAll('title').forEach(t => titles.push(t.textContent.trim()));
      console.warn('神戸市を特定できず。例：', titles.slice(0, 20));
      return;
    }
    found.forEach(el => {
      if (el.tagName.toLowerCase() === 'g') {
        el.querySelectorAll('path, polygon, rect, circle, ellipse').forEach(p => targets.add(p));
      } else {
        targets.add(el);
      }
    });

    // 3) 神戸市だけ赤（!important で最優先）
    targets.forEach(el => {
      el.removeAttribute('fill');
      if (el.style) el.style.setProperty('fill', RED, 'important');
      el.setAttribute('fill', RED);
    });

    console.log('神戸市として着色した要素数:', targets.size);
  });
</script>
</body>
</html>
